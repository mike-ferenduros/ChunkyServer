<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>Hello World!</title>
		<script>
		window.$ = window.jQuery = require('jquery')
		const {ipcRenderer, remote} = require('electron')
		</script>
	</head>
	<body>
		<h1>Hello World!</h1>

		<h3>Folders</h3>
		<ul id='folders'></ul>
		<button id='addFolder'>Add folder</button>

		<h3>Clients</h3>
		<ul id='clients'></ul>
		<button id='offer'>Add client</button>

		<h3>Server</h3>
		<div id='server'>
			<span class='status'></span>
			<span class='addresses'></span>
			<span class='dns'></span>
			<button class='stop'>Stop</button>
			<button class='start'>Start</button>
		</div>



		<script>
			function updateFolders() {
				$('ul#folders').empty().append(remote.getGlobal('config').folders.map((folder) => {
					let li = $('<li>')
					li.append($('<span>').text(folder.name))
					li.append($('<button>').addClass('remove').text('Remove').click(() => {
						ipcRenderer.send('remove-folder', folder)
						return false
					}))
					return li
				}))
			}
			ipcRenderer.on('update-folders', updateFolders)

			function updateClients() {
				$('ul#clients').empty().append(remote.getGlobal('config').clients.map((client) => {
					let li = $('<li>')
					li.append($('<span>').text(client.name))
					li.append($('<button>').addClass('remove').text('Remove').click(() => {
						ipcRenderer.send('remove-client', client)
						return false
					}))
					return li
				}))
			}
			ipcRenderer.on('update-clients', updateClients)

			function updateServer() {
				serverState = remote.getGlobal('serverState')
				$('div#server').toggleClass('running', serverState.running)
				$('div#server .status').text(serverState.status)
				$('div#server .addresses').text(serverState.addresses)
				$('div#server .dns').text(serverState.dnsSent ? 'Synced' : 'Not synced')
			}
			ipcRenderer.on('update-server', updateServer)

			$('div#server button.stop').click(() => ipcRenderer.send('stop-server'))
			$('div#server button.start').click(() => ipcRenderer.send('start-server'))
			$('button#offer').click(() => ipcRenderer.send('offer'))
			$('button#addFolder').click(() => ipcRenderer.send('add-folder'))

			updateFolders()
			updateClients()
			updateServer()
		</script>
	</body>
</html>

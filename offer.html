<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>OFFER</title>
		<script>
			const {ipcRenderer, remote} = require('electron')
			window.$ = window.jQuery = require('jquery')
			let qrcode = require('qrcode')
		</script>
	</head>
	<body>
		<div id='addresses'></div>
		<div id='key'></div>
		<img id='qrcode'>
		<script>
			function update() {
				let fingerprint = remote.getGlobal('config').cert.fingerprint
				let addresses = remote.getGlobal('serverAddresses')
				let key = remote.getGlobal('offerKey')
				$('div#addresses').text(addresses.join(', '))

				let qrbody = ['chunky',fingerprint,key].concat(addresses).join('/').toUpperCase()
				$('div#key').text(qrbody)
				qrcode.toDataURL(qrbody, {errorCorrectionLevel: 'L'}, (err,url) => {
					$('img#qrcode').attr('src', url)
				})
			}

			ipcRenderer.on('server-changed', update)
			update()

		</script>
	</body>
</html>
